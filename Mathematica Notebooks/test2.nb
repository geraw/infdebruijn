(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     51640,       1316]
NotebookOptionsPosition[     50297,       1269]
NotebookOutlinePosition[     50670,       1285]
CellTagsIndexPosition[     50627,       1282]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"f1", "[", "w_", "]"}], " ", ":=", " ", 
  RowBox[{"w", " ", "/.", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"d_", ",", " ", "x___"}], "}"}], " ", "->", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"d", " ", "+", " ", "1"}], ",", " ", "x"}], "}"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"f2", "[", 
   RowBox[{"w_", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
  RowBox[{"PadLeft", "[", 
   RowBox[{"w", ",", " ", "n"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"f3", "[", "w_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"w", " ", "/.", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Longest", "[", "uu__", "]"}], ",", " ", "vv__", ",", " ", 
        "uu__"}], "}"}], " ", "->", " ", 
      RowBox[{"{", 
       RowBox[{"vv", ",", " ", "uu"}], "}"}]}]}], " ", "/.", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"(", "uu__", ")"}], ".."}], "}"}], " ", "->", " ", 
     RowBox[{"{", "uu", "}"}]}]}]}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"f", "[", 
   RowBox[{"w_", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
  RowBox[{"f3", "[", 
   RowBox[{"f2", "[", 
    RowBox[{
     RowBox[{"f1", "[", "w", "]"}], ",", " ", "n"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ff", "[", 
    RowBox[{"w_", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
   RowBox[{"NestWhile", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"#1", ",", " ", "n"}], "]"}], " ", "&"}], " ", ",", " ", 
     RowBox[{"f", "[", 
      RowBox[{"w", ",", " ", "n"}], "]"}], ",", "  ", 
     RowBox[{
      RowBox[{"!", 
       RowBox[{"Divisible", "[", 
        RowBox[{"n", ",", " ", 
         RowBox[{"Length", "[", "#1", "]"}]}], "]"}]}], " ", "&"}]}], " ", 
    "]"}]}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"b1", "[", 
   RowBox[{"w_", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Take", "[", 
   RowBox[{
    RowBox[{"Join", " ", "@@", " ", 
     RowBox[{"Array", "[", 
      RowBox[{
       RowBox[{"w", " ", "&"}], " ", ",", " ", 
       RowBox[{"Ceiling", "[", 
        RowBox[{"n", "/", 
         RowBox[{"Length", "[", "w", "]"}]}], "]"}]}], "]"}]}], ",", " ", 
    RowBox[{"-", "n"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"b2", "[", "w_", "]"}], " ", ":=", " ", 
  RowBox[{"w", " ", "/.", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Longest", "[", 
       RowBox[{
        RowBox[{"(", "0", ")"}], ".."}], "]"}], ",", " ", "x__"}], "}"}], " ",
     "->", " ", 
    RowBox[{"{", "x", "}"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"b3", "[", "w_", "]"}], " ", ":=", " ", 
   RowBox[{"w", " ", "/.", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"d_", ",", " ", "x___"}], "}"}], " ", "->", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"d", " ", "-", " ", "1"}], ",", " ", "x"}], "}"}]}]}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b", "[", 
   RowBox[{"w_", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
  RowBox[{"b3", "[", 
   RowBox[{"b2", "[", 
    RowBox[{"b1", "[", 
     RowBox[{"w", ",", " ", "n"}], "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"bb", "[", 
    RowBox[{"w_", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
   RowBox[{"NestWhile", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"b", "[", 
       RowBox[{"#1", ",", " ", "n"}], "]"}], " ", "&"}], " ", ",", " ", 
     RowBox[{"b", "[", 
      RowBox[{"w", ",", " ", "n"}], "]"}], ",", "  ", 
     RowBox[{
      RowBox[{"!", 
       RowBox[{"Divisible", "[", 
        RowBox[{"n", ",", " ", 
         RowBox[{"Length", "[", "#1", "]"}]}], "]"}]}], " ", "&"}]}], " ", 
    "]"}]}], "\n", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lst", "[", 
   RowBox[{"n_", ",", "k_"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"lst", "[", 
    RowBox[{"n", ",", "k"}], "]"}], " ", "=", " ", 
   RowBox[{"NestWhileList", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ff", "[", 
       RowBox[{"#1", ",", " ", "n"}], "]"}], " ", "&"}], " ", ",", " ", 
     RowBox[{"{", "0", "}"}], ",", " ", 
     RowBox[{
      RowBox[{"#1", " ", "!=", " ", 
       RowBox[{"{", 
        RowBox[{"k", " ", "-", " ", "1"}], "}"}]}], " ", "&"}]}], " ", 
    "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.68938989305142*^9, 3.6893898933875103`*^9}, {
  3.6893899401956005`*^9, 3.6893899518276076`*^9}, {3.689390021639646*^9, 
  3.6893900312671223`*^9}}],

Cell[BoxData[{
 RowBox[{"On", "[", "Assert", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"necklace", "[", "w_", "]"}], ":=", 
   RowBox[{"Sort", "[", 
    RowBox[{"NestList", "[", 
     RowBox[{"RotateLeft", ",", "w", ",", 
      RowBox[{
       RowBox[{"Length", "[", "w", "]"}], "-", "1"}]}], "]"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vv", "[", "w_", "]"}], ":=", 
   RowBox[{"FromDigits", "[", 
    RowBox[{
     RowBox[{"Reverse", "[", "w", "]"}], ",", 
     RowBox[{
      RowBox[{"Max", "[", "w", "]"}], "+", "1"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "isLastInNecklace", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"isLastInNecklace", "[", 
    RowBox[{"{", 
     RowBox[{"w___", ",", 
      RowBox[{"Longest", "[", 
       RowBox[{"z___", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"#", "==", "0"}], ")"}], "&"}], ")"}]}], "]"}]}], "}"}], 
    "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"isLastInNecklace", "[", 
      RowBox[{"{", 
       RowBox[{"w", ",", "z"}], "}"}], "]"}], "=", "\[IndentingNewLine]", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"{", "w", "}"}], "]"}], "\[Equal]", "0"}], " ", "\[Or]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", "w", "}"}], "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}], "\[NotEqual]", "0"}], " ", "\[And]", 
        RowBox[{"And", " ", "@@", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"vv", "[", 
               RowBox[{"{", 
                RowBox[{"z", ",", "w"}], "}"}], "]"}], "\[GreaterEqual]", " ", 
              RowBox[{"vv", "[", "#", "]"}]}], ")"}], "&"}], " ", "/@", " ", 
           RowBox[{"necklace", "[", 
            RowBox[{"{", 
             RowBox[{"z", ",", "w"}], "}"}], "]"}]}], ")"}]}]}], ")"}]}]}], 
    ")"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Assert", "[", 
  RowBox[{
   RowBox[{"isLastInNecklace", "[", 
    RowBox[{"{", 
     RowBox[{
     "1", ",", "2", ",", "3", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}],
     "]"}], "\[Equal]", "True"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Assert", "[", 
  RowBox[{
   RowBox[{"isLastInNecklace", "[", 
    RowBox[{"{", 
     RowBox[{
     "3", ",", "0", ",", "0", ",", "0", ",", "3", ",", "0", ",", "0"}], "}"}],
     "]"}], "\[Equal]", "False"}], "]"}]}], "Input",
 CellChangeTimes->{{3.688976234478098*^9, 3.6889762524600725`*^9}, {
   3.6889763074911747`*^9, 3.6889763342124805`*^9}, {3.688976366055996*^9, 
   3.6889764214218493`*^9}, {3.6889764882454977`*^9, 3.688976651195603*^9}, {
   3.6889767450643797`*^9, 3.6889768221013393`*^9}, {3.688976958524136*^9, 
   3.6889770322663994`*^9}, {3.688977292652092*^9, 3.6889774450528893`*^9}, {
   3.6889774876016703`*^9, 3.6889775542533464`*^9}, {3.6889776240918427`*^9, 
   3.688977817685827*^9}, {3.688977853201903*^9, 3.6889779240597696`*^9}, {
   3.6889779605055113`*^9, 3.688977969938307*^9}, {3.688981142096652*^9, 
   3.688981392285001*^9}, {3.688981634185872*^9, 3.688981638153495*^9}, {
   3.6889859234396296`*^9, 3.6889859514231234`*^9}, {3.6889862978340645`*^9, 
   3.688986315161517*^9}, {3.688986353929138*^9, 3.688986398440556*^9}, {
   3.6889864354800353`*^9, 3.688986443432291*^9}, {3.6889871655665474`*^9, 
   3.6889871657576733`*^9}, {3.688987243276906*^9, 3.6889872856769285`*^9}, 
   3.6889878430773125`*^9, {3.688987924884379*^9, 3.688988047106155*^9}, {
   3.688988117201481*^9, 3.688988125137726*^9}, {3.689133621048098*^9, 
   3.6891336975255175`*^9}, {3.689133741643633*^9, 3.6891338148777533`*^9}, {
   3.689136391584031*^9, 3.689136444928276*^9}, 3.6893898672287483`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"nnxt", "[", 
   RowBox[{"{", 
    RowBox[{"\[Sigma]_", ",", "w__"}], "}"}], "]"}], ":=", 
  TagBox[GridBox[{
     {"\[Piecewise]", GridBox[{
        {
         RowBox[{"{", 
          RowBox[{"w", ",", 
           RowBox[{"\[Sigma]", "+", "1"}]}], "}"}], 
         RowBox[{"isLastInNecklace", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\[Sigma]", "+", "1"}], ",", "w"}], "}"}], "]"}]},
        {
         RowBox[{"{", 
          RowBox[{"w", ",", "0"}], "}"}], 
         RowBox[{"isLastInNecklace", "[", 
          RowBox[{"{", 
           RowBox[{"\[Sigma]", ",", "w"}], "}"}], "]"}]},
        {
         RowBox[{"{", 
          RowBox[{"w", ",", "\[Sigma]"}], "}"}], 
         TagBox["True",
          "PiecewiseDefault",
          AutoDelete->True]}
       },
       AllowedDimensions->{2, Automatic},
       Editable->True,
       GridBoxAlignment->{
        "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}},
          "RowsIndexed" -> {}},
       GridBoxItemSize->{
        "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
         "RowsIndexed" -> {}},
       GridBoxSpacings->{"Columns" -> {
           Offset[0.27999999999999997`], {
            Offset[0.84]}, 
           Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
           Offset[0.2], {
            Offset[0.4]}, 
           Offset[0.2]}, "RowsIndexed" -> {}},
       Selectable->True]}
    },
    GridBoxAlignment->{
     "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxItemSize->{
     "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.35]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}],
   "Piecewise",
   DeleteWithContents->True,
   Editable->False,
   SelectWithContents->True,
   Selectable->False]}]], "Input",
 CellChangeTimes->{{3.688963919740117*^9, 3.688964012931707*^9}, {
  3.6889814107331924`*^9, 3.6889814156134186`*^9}, {3.68898152039667*^9, 
  3.6889815386197133`*^9}, {3.6889872037107573`*^9, 3.688987223277689*^9}}],

Cell[BoxData[
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{"ValueQ", "[", "\"\<cyc\>\"", "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nn", "=", "6"}], ";", "\[IndentingNewLine]", 
    RowBox[{"s1", "=", 
     RowBox[{"Row", " ", "/@", " ", 
      RowBox[{"cyc", "[", 
       RowBox[{"nn", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"lst", "[", 
          RowBox[{"nn", ",", "4"}], "]"}], "]"}]}], "]"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"s2", "=", 
     RowBox[{"Row", " ", "/@", " ", 
      RowBox[{"NestList", "[", 
       RowBox[{"nnxt", ",", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "nn"}], "]"}], ",", 
        RowBox[{
         RowBox[{"Length", "[", "s1", "]"}], "-", "1"}]}], "]"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Assert", "[", 
     RowBox[{"s1", "==", "s2"}], "]"}]}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.68853833187928*^9, 3.6885383362861853`*^9}, {
   3.688538374936599*^9, 3.688538384155613*^9}, {3.6885384955243235`*^9, 
   3.688538498286776*^9}, 3.6885388518457813`*^9, {3.688628169959319*^9, 
   3.6886281813347363`*^9}, {3.6886283015561113`*^9, 
   3.6886283155392327`*^9}, {3.6886283576516814`*^9, 
   3.6886283609308186`*^9}, {3.688628415233219*^9, 3.688628418113097*^9}, {
   3.6886308103316393`*^9, 3.688630810522766*^9}, {3.6886309152250214`*^9, 
   3.688630916392783*^9}, {3.6886310002794714`*^9, 3.688631094052604*^9}, {
   3.6886311293806353`*^9, 3.688631158531639*^9}, {3.688631212978134*^9, 
   3.688631281328693*^9}, {3.688806464681531*^9, 3.6888064652086*^9}, {
   3.688985968990734*^9, 3.6889859893101635`*^9}, {3.688987178366007*^9, 
   3.6889871838856544`*^9}, {3.6891339763293924`*^9, 
   3.6891340091212907`*^9}, {3.689134190369404*^9, 3.689134225049698*^9}, {
   3.6891342576425667`*^9, 3.6891342824716454`*^9}, {3.6891362092027073`*^9, 
   3.68913621143734*^9}, {3.689136334966942*^9, 3.689136335905657*^9}, {
   3.689390039893363*^9, 3.68939004061055*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"prv", "[", 
   RowBox[{"{", 
    RowBox[{"w__", ",", "\[Sigma]_"}], "}"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Piecewise", "[", 
   RowBox[{
    RowBox[{"Join", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Sigma]", "-", "1"}], ",", "w"}], "}"}], ",", "  ", 
         RowBox[{"isLastInNecklace", "[", 
          RowBox[{"{", 
           RowBox[{"\[Sigma]", ",", "w"}], "}"}], "]"}]}], "}"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", "w"}], "}"}], ",", 
          RowBox[{
           RowBox[{"isLastInNecklace", "[", 
            RowBox[{"{", 
             RowBox[{"#", ",", "w"}], "}"}], "]"}], "\[And]", 
           RowBox[{"\[Sigma]", "\[Equal]", " ", "0"}]}]}], "}"}], "&"}], " ", 
       "/@", " ", 
       RowBox[{"Most", "[", 
        RowBox[{"Reverse", "[", 
         RowBox[{"Union", "[", 
          RowBox[{
           RowBox[{"{", "w", "}"}], ",", 
           RowBox[{
            RowBox[{"{", "w", "}"}], "-", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"-", "1"}], "}"}]}], "]"}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Sigma]", ",", "w"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6888061489376955`*^9, 3.688806149397798*^9}, {
   3.6888061868410378`*^9, 3.6888062122655945`*^9}, {3.6888063122096415`*^9, 
   3.6888064234310293`*^9}, {3.6888068737832747`*^9, 3.688806913328169*^9}, {
   3.6888073021885633`*^9, 3.688807332713047*^9}, {3.688807372089491*^9, 
   3.688807376366497*^9}, {3.688807417443073*^9, 3.6888074586129956`*^9}, {
   3.6888075409863386`*^9, 3.6888075497726583`*^9}, {3.6888075976027484`*^9, 
   3.688807672709201*^9}, {3.688807733220118*^9, 3.6888077348736935`*^9}, {
   3.688962123573831*^9, 3.6889621253286753`*^9}, {3.688962271556117*^9, 
   3.6889625782223673`*^9}, {3.6889627012052126`*^9, 3.688962715940668*^9}, {
   3.6889627625315638`*^9, 3.688962856880104*^9}, {3.6889631055781517`*^9, 
   3.6889632120078087`*^9}, {3.688963301014062*^9, 3.6889633743570642`*^9}, 
   3.6889635272811513`*^9, {3.6889635592810946`*^9, 3.688963580641074*^9}, {
   3.688963614815593*^9, 3.688963633055648*^9}, {3.6889636835670304`*^9, 
   3.6889637050062*^9}, {3.6889642157357397`*^9, 3.688964250119464*^9}, {
   3.6889642852546844`*^9, 3.688964420100803*^9}, {3.6889644649644537`*^9, 
   3.688964486307559*^9}, {3.6889645624038515`*^9, 3.6889647435365615`*^9}, 
   3.688964774303896*^9, {3.6889649114865594`*^9, 3.6889649433426123`*^9}, {
   3.6889649833440495`*^9, 3.688964983757323*^9}, 3.6889672121320496`*^9, {
   3.6889673346210027`*^9, 3.6889673421890044`*^9}, {3.688967384395899*^9, 
   3.688967386268136*^9}, {3.6889778267324142`*^9, 3.6889778326895227`*^9}, {
   3.688981473644771*^9, 3.6889814847951417`*^9}, {3.6889815527320395`*^9, 
   3.688981558698983*^9}, {3.688981652586033*^9, 3.6889817270012145`*^9}, {
   3.6889873148452053`*^9, 3.688987316604368*^9}, {3.688987453658947*^9, 
   3.6889874604914627`*^9}, {3.688987610521617*^9, 3.6889876477842445`*^9}, {
   3.688987692536821*^9, 3.6889877051921844`*^9}, 3.6889880949617825`*^9, {
   3.688988143489855*^9, 3.688988148865408*^9}, {3.6891335129557905`*^9, 
   3.689133559693679*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nn", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"l", "=", 
   SuperscriptBox["4", "4"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"s", "=", 
   RowBox[{"RandomInteger", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}], ",", "nn"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"s", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", "nn"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"l1", "=", 
   RowBox[{"NestList", "[", 
    RowBox[{"nnxt", ",", "s", ",", "l"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"l2", "=", 
    RowBox[{"Reverse", "[", 
     RowBox[{"NestList", "[", 
      RowBox[{"prv", ",", 
       RowBox[{"l1", "\[LeftDoubleBracket]", 
        RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], ",", 
       RowBox[{
        RowBox[{"Length", "[", "l1", "]"}], "-", "1"}]}], "]"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Assert", "[", 
  RowBox[{"l1", "\[Equal]", "l2"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Assert", "[", 
  RowBox[{"DuplicateFreeQ", "[", "l1", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.688806435261401*^9, 3.688806441015011*^9}, {
   3.688806496165207*^9, 3.6888066723517942`*^9}, {3.6888067025671425`*^9, 
   3.6888067369564486`*^9}, {3.6888074668198423`*^9, 3.688807500468486*^9}, {
   3.6888075560714927`*^9, 3.688807581277296*^9}, {3.688807683683242*^9, 
   3.688807714897767*^9}, {3.688962607531859*^9, 3.688962666775215*^9}, {
   3.688963179655635*^9, 3.688963182823708*^9}, {3.6889632222795315`*^9, 
   3.688963263877756*^9}, {3.688963379587487*^9, 3.688963407474741*^9}, {
   3.688963513425082*^9, 3.6889635138893857`*^9}, {3.6889644988348384`*^9, 
   3.6889645003868647`*^9}, {3.6889647795993958`*^9, 
   3.6889648096152325`*^9}, {3.68896492852582*^9, 3.688964928748967*^9}, {
   3.688967221598306*^9, 3.688967224462199*^9}, {3.688967352492813*^9, 
   3.6889673527639933`*^9}, {3.688967392939545*^9, 3.6889673938511467`*^9}, {
   3.6889674381714387`*^9, 3.6889674383946095`*^9}, {3.6889674731475544`*^9, 
   3.6889675926805525`*^9}, {3.688967623944216*^9, 3.688967630328435*^9}, {
   3.68898142514872*^9, 3.6889814296927238`*^9}, {3.6889814668762984`*^9, 
   3.6889814704756765`*^9}, {3.6889815746024942`*^9, 3.68898158229858*^9}, {
   3.6889817689359283`*^9, 3.6889817709682713`*^9}, 3.6889873817714367`*^9, {
   3.688987743030192*^9, 3.6889877811103587`*^9}, {3.688988065554347*^9, 
   3.6889880686093664`*^9}, {3.689133436521721*^9, 3.6891334618267517`*^9}, {
   3.6891342968186398`*^9, 3.6891343283516407`*^9}, {3.6891344037881684`*^9, 
   3.68913441129941*^9}, {3.6891345710282197`*^9, 3.6891346056728287`*^9}, {
   3.689134689592035*^9, 3.6891346921369295`*^9}, {3.689134815006028*^9, 
   3.6891348609537363`*^9}, {3.6891349330145226`*^9, 3.689134960025736*^9}, {
   3.689135004256349*^9, 3.689135030946267*^9}, {3.68913568700373*^9, 
   3.6891356876502523`*^9}, {3.689139391233835*^9, 3.6891393987802105`*^9}, {
   3.689140246978972*^9, 3.6891402634402122`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dec", "[", 
   RowBox[{"{", 
    RowBox[{"\[Sigma]_", ",", "w__"}], "}"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"\[Sigma]", "-", "1"}], ",", "w"}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"pm", "[", "l_", "]"}], ":=", 
   RowBox[{"And", "@@", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Not", "[", 
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{"l", ",", 
           RowBox[{
            RowBox[{"-", "i"}], "+", "1"}]}], "]"}], ",", 
         RowBox[{"dec", "[", 
          RowBox[{"l", "\[LeftDoubleBracket]", 
           RowBox[{"-", "i"}], "\[RightDoubleBracket]"}], "]"}]}], "]"}], 
       "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "l", "]"}]}], "}"}]}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Assert", "[", 
  RowBox[{
   RowBox[{"pm", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2", ",", "3"}], "}"}]}], "}"}], "]"}], "\[Equal]", 
   "False"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Assert", "[", 
  RowBox[{
   RowBox[{"pm", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2", ",", "3"}], "}"}]}], "}"}], "]"}], "\[Equal]", 
   "False"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Assert", "[", 
  RowBox[{
   RowBox[{"pm", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2", ",", "3"}], "}"}]}], "}"}], "]"}], "\[Equal]", 
   "False"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Assert", "[", 
  RowBox[{
   RowBox[{"pm", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2", ",", "3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2", ",", "2"}], "}"}]}], "}"}], "]"}], "\[Equal]", 
   "True"}], "]"}]}], "Input",
 CellChangeTimes->{{3.689135092930914*^9, 3.6891351042405324`*^9}, {
  3.68913514141798*^9, 3.6891353785215254`*^9}, {3.6891354088675227`*^9, 
  3.6891355742859735`*^9}, {3.6891356640647354`*^9, 3.6891357383193493`*^9}, {
  3.689135768912777*^9, 3.6891357743902044`*^9}, {3.6891358118271017`*^9, 
  3.6891358346794057`*^9}, {3.6891358737719374`*^9, 3.6891360742293816`*^9}, {
  3.689136491562475*^9, 3.6891365562777047`*^9}, {3.6891368890198765`*^9, 
  3.689136896931326*^9}, {3.6891370339928274`*^9, 3.689137059100732*^9}, {
  3.6891384260056806`*^9, 3.6891385649736023`*^9}, {3.689138650751065*^9, 
  3.689138953307508*^9}, {3.689139166266262*^9, 3.689139234856958*^9}, {
  3.6891392755122232`*^9, 3.689139276113489*^9}, {3.6891393296840863`*^9, 
  3.6891393632603693`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"pm", "[", "l1", "]"}]], "Input",
 CellChangeTimes->{{3.6891359926400256`*^9, 3.6891359949707193`*^9}, {
  3.689136561859251*^9, 3.6891365664531574`*^9}, {3.689139242450194*^9, 
  3.6891392427378483`*^9}}],

Cell[BoxData[
 FormBox["True", TraditionalForm]], "Output",
 CellChangeTimes->{
  3.689136581005766*^9, 3.6891369061826787`*^9, 3.689139249412473*^9, 
   3.6891394070296087`*^9, {3.6891394612579565`*^9, 3.6891394656090765`*^9}, 
   3.689165638344525*^9, 3.689231895776018*^9, 3.689389832762831*^9, 
   3.6893899744974537`*^9, 3.689411322849414*^9, 3.689562379695436*^9, 
   3.689562830781558*^9, 3.6895794713632755`*^9, 3.68957975784361*^9, 
   3.689745812285818*^9, 3.6897705020252094`*^9, 3.689821118537863*^9, 
   3.6905961473371706`*^9, 3.6908002503560038`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"m", "[", "e_", "]"}], ":=", 
  RowBox[{"MemberQ", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
    "e"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"pos", "[", "w_", "]"}], ":=", 
   RowBox[{"Flatten", " ", "[", " ", 
    RowBox[{"Position", "[", 
     RowBox[{"l1", ",", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"necklace", "[", "w", "]"}], ",", "#"}], "]"}], "&"}], 
        ")"}]}]}], "]"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"isBefore", "[", 
    RowBox[{"w1_", ",", "w2_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Max", "[", 
     RowBox[{"pos", "[", "w1", "]"}], "]"}], " ", "<", " ", 
    RowBox[{"Min", "[", 
     RowBox[{"pos", "[", "w2", "]"}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"isBefore", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "1", ",", "0"}], "}"}]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"testWord", "[", "w_", "]"}], ":=", 
   RowBox[{"And", " ", "@@", " ", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"w", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
         "\[NotEqual]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"isBefore", "[", 
         RowBox[{"w", ",", 
          RowBox[{"ReplacePart", "[", 
           RowBox[{"w", ",", 
            RowBox[{"i", "\[Rule]", 
             RowBox[{
              RowBox[{
              "w", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", "1"}]}]}], "]"}]}], "]"}], ",", "True"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "w", "]"}]}], "}"}]}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"And", " ", "@@", 
  RowBox[{"(", 
   RowBox[{"testWord", " ", "/@", " ", 
    RowBox[{"Take", "[", 
     RowBox[{"l1", ",", 
      RowBox[{"3", "^", "4"}]}], "]"}]}], ")"}]}]}], "Input",
 CellChangeTimes->{{3.689140091357464*^9, 3.6891401281903567`*^9}, {
  3.689140179467078*^9, 3.6891402028787193`*^9}, {3.6891402982118683`*^9, 
  3.689140321421303*^9}, {3.689140426801841*^9, 3.6891404954318943`*^9}, {
  3.689140529615407*^9, 3.6891406712998285`*^9}, {3.689140703503602*^9, 
  3.6891408008310165`*^9}, {3.689140887645141*^9, 3.6891409882052765`*^9}, {
  3.6891410497598395`*^9, 3.6891412602885504`*^9}, {3.6891415624597635`*^9, 
  3.6891415767263603`*^9}}],

Cell[BoxData[
 FormBox["True", TraditionalForm]], "Output",
 CellChangeTimes->{
  3.6891402056960373`*^9, {3.689140293811081*^9, 3.689140322292164*^9}, {
   3.689140487625638*^9, 3.6891404961110992`*^9}, {3.689140582019261*^9, 
   3.6891405985264573`*^9}, {3.689140630160057*^9, 3.689140720080909*^9}, 
   3.689140920907586*^9, {3.6891411048556314`*^9, 3.6891412619024897`*^9}, 
   3.6891415472505236`*^9, 3.6891656383775325`*^9, 3.6892318958072667`*^9, 
   3.6893898328048425`*^9, 3.6893899745284615`*^9, 3.6894113228684287`*^9, 
   3.6895623797324605`*^9, 3.6895628308095765`*^9, 3.6895794713942957`*^9, 
   3.689579757872628*^9, 3.6897458123850813`*^9, 3.6897705021265984`*^9, 
   3.689821118568883*^9, 3.690596147370192*^9, 3.69080025038002*^9}],

Cell[BoxData[
 FormBox["True", TraditionalForm]], "Output",
 CellChangeTimes->{
  3.6891402056960373`*^9, {3.689140293811081*^9, 3.689140322292164*^9}, {
   3.689140487625638*^9, 3.6891404961110992`*^9}, {3.689140582019261*^9, 
   3.6891405985264573`*^9}, {3.689140630160057*^9, 3.689140720080909*^9}, 
   3.689140920907586*^9, {3.6891411048556314`*^9, 3.6891412619024897`*^9}, 
   3.6891415472505236`*^9, 3.6891656383775325`*^9, 3.6892318958072667`*^9, 
   3.6893898328048425`*^9, 3.6893899745284615`*^9, 3.6894113228684287`*^9, 
   3.6895623797324605`*^9, 3.6895628308095765`*^9, 3.6895794713942957`*^9, 
   3.689579757872628*^9, 3.6897458123850813`*^9, 3.6897705021265984`*^9, 
   3.689821118568883*^9, 3.690596147370192*^9, 3.6908002537162075`*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"trim", "[", "w_", "]"}], ":=", 
  RowBox[{"Prepend", "[", 
   RowBox[{
    RowBox[{"Take", "[", 
     RowBox[{"w", ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Sow", "[", 
          RowBox[{"FirstPosition", "[", 
           RowBox[{"w", ",", 
            RowBox[{"_Integer", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"#", "\[NotEqual]", "0"}], ")"}], "&"}], ")"}]}]}], 
           "]"}], "]"}], "\[LeftDoubleBracket]", "1", 
         "\[RightDoubleBracket]"}], ",", 
        RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", "1"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"value", "[", "w_", "]"}], ":=", 
   RowBox[{"FromDigits", "[", 
    RowBox[{
     RowBox[{"Sow", "[", 
      RowBox[{"trim", "[", 
       RowBox[{"Reverse", "[", "w", "]"}], "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Max", "[", "w", "]"}], "+", "1"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ordNecklace", "[", "nc_", "]"}], ":=", 
  RowBox[{"RotateLeft", "[", 
   RowBox[{"nc", ",", 
    RowBox[{
     RowBox[{"Position", "[", 
      RowBox[{"nc", ",", 
       RowBox[{
        RowBox[{"MaximalBy", "[", 
         RowBox[{"nc", ",", "value"}], "]"}], "\[LeftDoubleBracket]", "1", 
        "\[RightDoubleBracket]"}]}], "]"}], "\[LeftDoubleBracket]", 
     RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"onecklace", "[", "w_", "]"}], ":=", 
  RowBox[{"ordNecklace", "[", 
   RowBox[{"necklace", "[", "w", "]"}], "]"}]}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBWIQLbDtVnVbzWvHPY8MGkC0W5FEC4hO3+Q0GUQ/khae
DqIb5q0A03d4ri8A0dy/74PpuMJVy0D0qd29y0G0RxP7WhAdVnRmB4h+Ynt+
L4he2H10H4i+dXDhGRBt9/f9ORB9X1TkFogOebQSTBfXCP8F0ecu+jC0A+nM
uRsFQLQ9i4wIiC67e08aRFcwFqqD6CQOPxsQ/e3UCzDNGXjOE0SLrHHzAav3
rgkA0ZWiTmEguv/qm3gQvYrnfgqIZvi3MBtEGztK5oBoqeDkXhC9jefxIhBt
xtq3CkQXKX9eA6JDvi3YBpYvkrwJoift2fQSRHPcnPAHRAMAwAuyZw==
  "]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"onecklace", "[", 
  RowBox[{"{", 
   RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"onecklace", "[", 
  RowBox[{"{", 
   RowBox[{"2", ",", "0", ",", "0", ",", "0"}], "}"}], "]"}]}], "Input",
 CellChangeTimes->{{3.68916603287241*^9, 3.689166045986801*^9}, {
  3.689166077316897*^9, 3.6891661190126443`*^9}, {3.6891661532046337`*^9, 
  3.6891661569076023`*^9}, {3.6891662559811735`*^9, 3.6891662582917576`*^9}, {
  3.6891663402439117`*^9, 3.689166344698063*^9}, {3.689168066723523*^9, 
  3.6891680737293315`*^9}, {3.689168876164464*^9, 3.6891689166519036`*^9}}],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0", "0", "1", "0"},
     {"0", "1", "0", "0"},
     {"1", "0", "0", "0"},
     {"0", "0", "0", "1"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}], 
  TraditionalForm]], "Output",
 CellChangeTimes->{{3.6891688899280057`*^9, 3.689168917051007*^9}, 
   3.689231899132164*^9, 3.689389835105437*^9, 3.689389976810052*^9, 
   3.6894113251710243`*^9, 3.68956238354298*^9, 3.689562834248849*^9, 
   3.6895794748165584`*^9, 3.6895797612638702`*^9, 3.689745821179511*^9, 
   3.689770509952032*^9, 3.689821122013159*^9, 3.69059615075241*^9, 
   3.6908002537792473`*^9}],

Cell[BoxData[
 FormBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0", "0", "2", "0"},
     {"0", "2", "0", "0"},
     {"2", "0", "0", "0"},
     {"0", "0", "0", "2"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}], 
  TraditionalForm]], "Output",
 CellChangeTimes->{{3.6891688899280057`*^9, 3.689168917051007*^9}, 
   3.689231899132164*^9, 3.689389835105437*^9, 3.689389976810052*^9, 
   3.6894113251710243`*^9, 3.68956238354298*^9, 3.689562834248849*^9, 
   3.6895794748165584`*^9, 3.6895797612638702`*^9, 3.689745821179511*^9, 
   3.689770509952032*^9, 3.689821122013159*^9, 3.69059615075241*^9, 
   3.6908002537822495`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"w", ":=", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "1", ",", "2", ",", "2", ",", "1"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"n", "=", 
    RowBox[{"Length", "[", "w", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"z", "[", 
    RowBox[{"{", 
     RowBox[{"w___", ",", 
      RowBox[{"Longest", "[", 
       RowBox[{"z___", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"#", "==", "0"}], ")"}], "&"}], ")"}]}], "]"}]}], "}"}], 
    "]"}], ":=", 
   RowBox[{"Length", "[", 
    RowBox[{"{", "z", "}"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"seq", "=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{"w", ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"w1", "=", 
          RowBox[{"i", "=", "0"}]}], ";", 
         RowBox[{"NestWhile", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"i", "++"}], ";", 
              RowBox[{"RotateRight", "[", "#", "]"}]}], ")"}], "&"}], ",", 
           "w", ",", 
           RowBox[{
            RowBox[{"Not", "[", 
             RowBox[{"isLastInNecklace", "[", "#", "]"}], "]"}], "&"}]}], 
          "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"w2", "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"w", ",", 
           RowBox[{
            RowBox[{"_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"#", ">", 
                 RowBox[{"n", "-", "i"}]}], ")"}], "&"}], ")"}]}], "\[Rule]", 
            "0"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"w3", "=", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"w2", ",", 
           RowBox[{"1", "\[Rule]", 
            RowBox[{
             RowBox[{
             "w2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             "+", "1"}]}]}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"w4", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"i", "=", "0"}], ";", 
           RowBox[{"NestWhile", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"i", "++"}], ";", 
                RowBox[{"RotateLeft", "[", "#", "]"}]}], ")"}], "&"}], ",", 
             "w3", ",", 
             RowBox[{
              RowBox[{"Not", "[", 
               RowBox[{"isLastInNecklace", "[", "#", "]"}], "]"}], "&"}]}], 
            "]"}]}], ")"}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{"w5", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<i=\>\"", ",", "i"}], "]"}], ";", 
           RowBox[{"ReplacePart", "[", 
            RowBox[{
             RowBox[{"RotateLeft", "[", 
              RowBox[{"w4", ",", 
               RowBox[{"n", "-", "i", "-", "1"}]}], "]"}], ",", 
             RowBox[{
              RowBox[{"_", "?", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", ">", 
                   RowBox[{"i", "+", "1"}]}], ")"}], "&"}], ")"}]}], 
              "\[Rule]", "0"}]}], "]"}]}], ")"}]}]}], "\[IndentingNewLine]", 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ww", "=", "w5"}], ";", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ww", "=", 
          RowBox[{"RotateRight", "[", 
           RowBox[{"ReplacePart", "[", 
            RowBox[{"ww", ",", 
             RowBox[{"1", "\[Rule]", 
              RowBox[{"w", "\[LeftDoubleBracket]", 
               RowBox[{"-", "j"}], "\[RightDoubleBracket]"}]}]}], "]"}], 
           "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"n", "-", "i"}]}], "}"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"RotateLeft", "[", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"ww", ",", 
           RowBox[{"1", "\[Rule]", 
            RowBox[{
             RowBox[{
             "ww", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             "+", "1"}]}]}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"ReplacePart", "[", 
         RowBox[{"w", ",", 
          RowBox[{"1", "\[Rule]", 
           RowBox[{
            RowBox[{
            "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+", 
            "1"}]}]}], "]"}]}], "\[IndentingNewLine]", "}"}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]", " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", " ", "@@", 
   RowBox[{"Riffle", "[", 
    RowBox[{
     RowBox[{"Row", " ", "/@", "seq"}], ",", "\"\<\[LessEqual]\>\""}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"s", " ", "=", 
   RowBox[{"NestList", "[", 
    RowBox[{"nnxt", ",", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", "n"}], "]"}], ",", 
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Max", "[", "w", "]"}], "+", "2"}], ")"}], "n"]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Position", "[", 
     RowBox[{"s", ",", "#"}], "]"}], "\[LeftDoubleBracket]", 
    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "&"}], "  ", "/@", 
  " ", "seq"}]}], "Input",
 CellChangeTimes->{
  3.689411173074725*^9, {3.6894112087539434`*^9, 3.6894112953873286`*^9}, {
   3.689411347330738*^9, 3.68941149660032*^9}, {3.6894115477015266`*^9, 
   3.6894115917979174`*^9}, {3.6894116687978067`*^9, 3.689411772886697*^9}, {
   3.6894119281368113`*^9, 3.68941217218487*^9}, {3.689412288900039*^9, 
   3.6894123390700026`*^9}, {3.6894123831623955`*^9, 
   3.6894123897821074`*^9}, {3.689412477913874*^9, 3.689412864842857*^9}, {
   3.6894129001719723`*^9, 3.689412921788557*^9}, {3.6894130321790857`*^9, 
   3.6894131756771708`*^9}, {3.689413218841324*^9, 3.689413314891142*^9}, {
   3.6894133631126018`*^9, 3.6894134728999686`*^9}, {3.6894135836415834`*^9, 
   3.6894135867583885`*^9}, {3.6894136290103054`*^9, 
   3.6894136295964575`*^9}, {3.6894159438974915`*^9, 
   3.6894159995858693`*^9}, {3.689419435949498*^9, 3.689419437878997*^9}, 
   3.6894195519474707`*^9, {3.6894312010154886`*^9, 3.689431247155424*^9}, {
   3.689431297090311*^9, 3.6894313777641563`*^9}, {3.6894314196139708`*^9, 
   3.689431471478372*^9}, {3.689431659610982*^9, 3.689431660161125*^9}, {
   3.6894318188271213`*^9, 3.6894318196243277`*^9}, {3.6894318584823694`*^9, 
   3.6894318886151533`*^9}, {3.689436896562701*^9, 3.689436908921894*^9}, {
   3.689436981110548*^9, 3.689437081871583*^9}, 3.689437120604591*^9, {
   3.689437191946024*^9, 3.6894373171403723`*^9}, {3.689437535121696*^9, 
   3.689437589182665*^9}, {3.6894376879061737`*^9, 3.689437695749201*^9}, {
   3.689437788002037*^9, 3.689437854951339*^9}, {3.6894379512145863`*^9, 
   3.689437952625952*^9}, {3.6894380223169575`*^9, 3.6894380555965567`*^9}, {
   3.6895624667199507`*^9, 3.689562511103284*^9}, {3.689562818731594*^9, 
   3.689562819115848*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 FormBox[
  InterpretationBox[
   RowBox[{"\<\"i=\"\>", "\[InvisibleSpace]", "0"}],
   SequenceForm["i=", 0],
   Editable->False], TraditionalForm]], "Print",
 CellChangeTimes->{{3.6894375757061825`*^9, 3.6894375896327815`*^9}, {
   3.689437689363551*^9, 3.6894376961593065`*^9}, {3.689437788737228*^9, 
   3.689437855690527*^9}, 3.689437953046059*^9, 3.6894380234482512`*^9, 
   3.6894380586673503`*^9, 3.689562383560991*^9, 3.68956251154958*^9, {
   3.6895628199744153`*^9, 3.6895628342738667`*^9}, 3.689579474832569*^9, 
   3.6895797612898865`*^9, 3.6897458212837596`*^9, 3.689770510002666*^9, 
   3.6898211220381765`*^9, 3.6905961507734227`*^9, 3.6908002537962584`*^9}],

Cell[BoxData[
 FormBox[
  InterpretationBox[
   RowBox[{
    TemplateBox[{"1","2","1","2","2","1"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"1","1","2","1","2","2"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"1","2","1","2","2","0"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"2","2","1","2","2","0"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"2","2","1","2","2","0"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"0","0","0","0","0","0"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"0","1","0","0","0","0"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"0","2","1","0","0","0"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"0","2","2","1","0","0"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"0","1","2","2","1","0"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"0","2","1","2","2","1"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"1","1","2","1","2","2"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"1","2","1","2","2","2"},
     "RowDefault"], "\[InvisibleSpace]", "\<\"\[LessEqual]\"\>", 
    "\[InvisibleSpace]", 
    TemplateBox[{"2","2","1","2","2","1"},
     "RowDefault"]}],
   SequenceForm[
    Row[{1, 2, 1, 2, 2, 1}], "\[LessEqual]", 
    Row[{1, 1, 2, 1, 2, 2}], "\[LessEqual]", 
    Row[{1, 2, 1, 2, 2, 0}], "\[LessEqual]", 
    Row[{2, 2, 1, 2, 2, 0}], "\[LessEqual]", 
    Row[{2, 2, 1, 2, 2, 0}], "\[LessEqual]", 
    Row[{0, 0, 0, 0, 0, 0}], "\[LessEqual]", 
    Row[{0, 1, 0, 0, 0, 0}], "\[LessEqual]", 
    Row[{0, 2, 1, 0, 0, 0}], "\[LessEqual]", 
    Row[{0, 2, 2, 1, 0, 0}], "\[LessEqual]", 
    Row[{0, 1, 2, 2, 1, 0}], "\[LessEqual]", 
    Row[{0, 2, 1, 2, 2, 1}], "\[LessEqual]", 
    Row[{1, 1, 2, 1, 2, 2}], "\[LessEqual]", 
    Row[{1, 2, 1, 2, 2, 2}], "\[LessEqual]", 
    Row[{2, 2, 1, 2, 2, 1}]],
   Editable->False], TraditionalForm]], "Print",
 CellChangeTimes->{{3.6894375757061825`*^9, 3.6894375896327815`*^9}, {
   3.689437689363551*^9, 3.6894376961593065`*^9}, {3.689437788737228*^9, 
   3.689437855690527*^9}, 3.689437953046059*^9, 3.6894380234482512`*^9, 
   3.6894380586673503`*^9, 3.689562383560991*^9, 3.68956251154958*^9, {
   3.6895628199744153`*^9, 3.6895628342738667`*^9}, 3.689579474832569*^9, 
   3.6895797612898865`*^9, 3.6897458212837596`*^9, 3.689770510002666*^9, 
   3.6898211220381765`*^9, 3.6905961507734227`*^9, 3.6908002538212748`*^9}]
}, Open  ]],

Cell[BoxData[
 FormBox[
  RowBox[{"{", 
   RowBox[{
   "601", ",", "606", ",", "607", ",", "616", ",", "616", ",", "1", ",", "17",
     ",", "69", ",", "420", ",", "518", ",", "589", ",", "606", ",", "687", 
    ",", "613"}], "}"}], TraditionalForm]], "Output",
 CellChangeTimes->{{3.6894375757341895`*^9, 3.689437589638853*^9}, {
   3.689437689368637*^9, 3.689437696165307*^9}, {3.6894377887452292`*^9, 
   3.6894378556965284`*^9}, 3.6894379530630646`*^9, 3.689438023655305*^9, 
   3.6894380587053614`*^9, 3.689562383849183*^9, 3.6895625116006117`*^9, {
   3.689562820021448*^9, 3.6895628345640574`*^9}, 3.689579475129766*^9, 
   3.6895797615810795`*^9, 3.689745822068844*^9, 3.6897705106037965`*^9, 
   3.689821122341376*^9, 3.6905961510536084`*^9, 3.6908002540984583`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"m", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n", "=", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sequence", "=", 
    RowBox[{"NestList", "[", 
     RowBox[{"nnxt", ",", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", "n"}], "]"}], ",", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"m", "+", "1"}], ")"}], "n"]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "PP", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PP", "[", "w_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"PP", "[", "w", "]"}], "=", 
     RowBox[{
      RowBox[{"Position", "[", 
       RowBox[{
        RowBox[{"RotateLeft", "[", "sequence", "]"}], ",", "w"}], "]"}], 
      "\[LeftDoubleBracket]", 
      RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], ")"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"notZero", "[", "v_", "]"}], ":=", 
  RowBox[{"Or", " ", "@@", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"#", "\[NotEqual]", " ", "0"}], ")"}], "&"}], " ", "/@", " ", 
     "v"}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"t1", "[", 
    RowBox[{"{", 
     RowBox[{"u_", ",", "v_"}], "}"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"notZero", "[", "v", "]"}], "\[And]", 
      RowBox[{"isLastInNecklace", "[", 
       RowBox[{"Join", "[", 
        RowBox[{"u", ",", "v"}], "]"}], "]"}]}], ")"}], " ", "\[Implies]", 
    " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"PP", "[", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"Length", "[", "u", "]"}]}], "]"}], ",", "v"}], "]"}], 
       "]"}], "<", "  ", 
      RowBox[{"PP", "[", 
       RowBox[{"Join", "[", 
        RowBox[{"u", ",", "v"}], "]"}], "]"}], "<", " ", 
      RowBox[{"PP", "[", 
       RowBox[{"Join", "[", 
        RowBox[{"v", ",", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"Length", "[", "u", "]"}]}], "]"}]}], "]"}], "]"}]}], 
     ")"}]}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tstvector", "[", 
    RowBox[{"n1_", ",", "n2_"}], "]"}], ":=", 
   RowBox[{"Tuples", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Tuples", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", "m"}], "]"}], ",", "n1"}], "]"}], ",", 
      RowBox[{"Tuples", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", "m"}], "]"}], ",", "n2"}], "]"}]}], "}"}], "]"}]}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"And", " ", "@@", " ", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"And", " ", "@@", " ", 
     RowBox[{"(", 
      RowBox[{"t1", " ", "/@", " ", 
       RowBox[{"tstvector", "[", 
        RowBox[{"n1", ",", 
         RowBox[{"n", "-", "n1"}]}], "]"}]}], ")"}]}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"n1", ",", "1", ",", 
      RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.6895623970879307`*^9, 3.6895624467787714`*^9}, {
   3.6895624947834983`*^9, 3.689562588398367*^9}, {3.6895627569877872`*^9, 
   3.689562804827405*^9}, {3.6895628550525985`*^9, 3.6895631443748107`*^9}, {
   3.689563334292327*^9, 3.6895633480203996`*^9}, {3.689573705670744*^9, 
   3.689573706870537*^9}, {3.689579316900191*^9, 3.6895794278485165`*^9}, {
   3.689579461548789*^9, 3.6895794616878805`*^9}, {3.689579536839548*^9, 
   3.689579573174562*^9}, 3.6895796228383846`*^9, {3.689579659829832*^9, 
   3.6895796600219593`*^9}, 3.689579750132513*^9, {3.6895798093316374`*^9, 
   3.6895798280670195`*^9}, {3.6895798727385426`*^9, 
   3.6895798991540008`*^9}, {3.6895800093288155`*^9, 3.689580015681015*^9}, {
   3.6895800606567373`*^9, 3.6895800702560816`*^9}, {3.689580370507517*^9, 
   3.6895804177877645`*^9}, {3.689580450890642*^9, 3.68958046533819*^9}, {
   3.689745858809972*^9, 3.6897459153423777`*^9}, 3.68977051934658*^9, {
   3.6905961996504855`*^9, 3.690596201586728*^9}, {3.690596270978212*^9, 
   3.6905962809447455`*^9}, {3.6905963628013964`*^9, 
   3.6905963990071273`*^9}, {3.6905964770212617`*^9, 
   3.6905964892462745`*^9}, {3.69059652820481*^9, 3.690596537451874*^9}, {
   3.69059671578576*^9, 3.6905967236729293`*^9}, {3.690596775319781*^9, 
   3.6905968488549795`*^9}, {3.6905970657471414`*^9, 
   3.6905972637108965`*^9}, {3.690597900131037*^9, 3.6905979118427134`*^9}, {
   3.6906178307374496`*^9, 3.69061790531133*^9}, {3.6906179679663963`*^9, 
   3.690617987325085*^9}}],

Cell[BoxData[
 FormBox["True", TraditionalForm]], "Output",
 CellChangeTimes->{{3.690597238587429*^9, 3.6905972596102085`*^9}, 
   3.6905972920614786`*^9, 3.690597900930561*^9, 3.690597940124251*^9, {
   3.6906178395402193`*^9, 3.6906178535914297`*^9}, {3.6906178873565607`*^9, 
   3.6906179063920383`*^9}, {3.6906179697045374`*^9, 3.6906179876132755`*^9}, 
   3.6908002541675034`*^9}]
}, Open  ]]
},
WindowSize->{1680, 967},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
Magnification:>1.3 Inherited,
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (July 28, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 4435, 134, 415, "Input"],
Cell[4996, 156, 3952, 94, 315, "Input"],
Cell[8951, 252, 2357, 65, 77, "Input"],
Cell[11311, 319, 2013, 41, 165, "Input"],
Cell[13327, 362, 3444, 70, 140, "Input"],
Cell[16774, 434, 3132, 62, 240, "Input"],
Cell[19909, 498, 3151, 86, 190, "Input"],
Cell[CellGroupData[{
Cell[23085, 588, 228, 4, 39, "Input"],
Cell[23316, 594, 565, 9, 38, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[23918, 608, 2954, 80, 315, "Input"],
Cell[26875, 690, 749, 11, 38, "Output"],
Cell[27627, 703, 752, 11, 38, "Output"]
}, Open  ]],
Cell[28394, 717, 2080, 57, 140, "Input"],
Cell[CellGroupData[{
Cell[30499, 778, 633, 12, 65, "Input"],
Cell[31135, 792, 1008, 24, 106, "Output"],
Cell[32146, 818, 1008, 24, 106, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[33191, 847, 7321, 184, 595, "Input"],
Cell[CellGroupData[{
Cell[40537, 1035, 687, 12, 29, "Print"],
Cell[41227, 1049, 3085, 67, 29, "Print"]
}, Open  ]],
Cell[44327, 1119, 775, 13, 38, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[45139, 1137, 4754, 121, 345, "Input"],
Cell[49896, 1260, 385, 6, 38, "Output"]
}, Open  ]]
}
]
*)

